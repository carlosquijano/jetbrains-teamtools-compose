version: '3.3'
services:
  # The reverse proxy service (Traefik)
  proxy:
    image: traefik  # The official Traefik docker image
    command: --web --docker --docker.domain=acme.local # Enables the web UI and tells Traefik to listen to docker
    ports:
      - "80:80"      # The HTTP port
      - "8080:8080"  # The Web UI (enabled by --api)
    volumes:
      - /var/run/docker.sock:/var/run/docker.sock  # So that Traefik can listen to the Docker events
    restart: always
  # Identity Provider (JetBrains Hub)
  hub:
    image: jetbrains/hub:2018.3.11014
    volumes:
      - hub_data_vol:/opt/hub/data
      - hub_logs_vol:/opt/hub/logs
      - hub_backups_vol:/opt/hub/backups
    restart: always
    ports:
      - "9081:8080"
    labels:
      - "traefik.port=8080"
      - "traefik.backend=hub"
      - "traefik.frontend.rule=Host:hub.acme.local"
  # Issue Management Service (JetBrains YouTrack)
  youtrack:
    image: jetbrains/youtrack:2018.3.47247
    depends_on:
      - hub
    links: 
      - hub
    volumes:
      - youtrack_data_vol:/opt/youtrack/data
      - youtrack_conf_vol:/opt/youtrack/conf
      - youtrack_logs_vol:/opt/youtrack/logs
      - youtrack_backups_vol:/opt/youtrack/backups
    restart: always
    ports:
      - "9082:8080"
    labels:
      - "traefik.port=8080"
      - "traefik.backend=youtrack"
      - "traefik.frontend.rule=Host:youtrack.acme.local"
volumes:
  # HUB volumes
  hub_data_vol:
  hub_logs_vol:
  hub_backups_vol:
  # YouTrack volumes
  youtrack_data_vol:
  youtrack_conf_vol:
  youtrack_logs_vol:
  youtrack_backups_vol: